<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: has_special_group
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: has_special_group</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><pre class="code ruby"><span class='comment'># -*- coding: utf-8 -*-
</span>
<span class='comment'># This module extends the Structureable models by methods for the interaction with special_groups
</span><span class='comment'># that are descendants of the structureable object.
</span><span class='comment'>#
</span><span class='comment'># For example,
</span><span class='comment'>#
</span><span class='comment'>#     class Page
</span><span class='comment'>#       is_structureable ...
</span><span class='comment'>#       has_special_group :officers_parent
</span><span class='comment'>#     end
</span><span class='comment'>#
</span><span class='comment'># will give you these instance methods:
</span><span class='comment'>#
</span><span class='comment'>#     some_page.find_officers_parent_group
</span><span class='comment'>#     some_page.create_officers_parent_group
</span><span class='comment'>#     some_page.find_or_create_officers_parent_group
</span><span class='comment'>#     some_page.officers_parent
</span><span class='comment'>#     some_page.officers_parent!
</span><span class='comment'>#     some_page.officers # =&gt; Array of descendant_users of the officers_parent child_group
</span><span class='comment'>#     some_page.officers &lt;&lt; some_users
</span><span class='comment'>#     some_page.officers! &lt;&lt; some_users  # creates the officers_parent_group on the way if absent
</span><span class='comment'>#
</span><span class='comment'># This will also work global, i.e. to produce class methods instead of instance methods.
</span><span class='comment'># 
</span><span class='comment'>#     class Group
</span><span class='comment'>#       is_structureable ...
</span><span class='comment'>#       has_special_group :everyone, global: true
</span><span class='comment'>#     Group
</span><span class='comment'>#
</span><span class='comment'># This will give you these class methods:
</span><span class='comment'>#
</span><span class='comment'>#     Group.find_everyone_group
</span><span class='comment'>#     Group.create_everyone_group
</span><span class='comment'>#     Group.find_or_create_everyone_group
</span><span class='comment'>#     Group.everyone
</span><span class='comment'>#     Group.everyone!
</span><span class='comment'># 
</span><span class='comment'># (The user accessors are created as well if the special_group&#39;s name ends with &#39;_parent&#39;.)
</span><span class='comment'># 
</span><span class='kw'>module</span> <span class='const'>StructureableMixins</span><span class='op'>::</span><span class='const'>HasSpecialGroup</span>

  <span class='id identifier rubyid_extend'>extend</span> <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>Concern</span>

  <span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='kw'>end</span>

  <span class='kw'>module</span> <span class='const'>ClassMethods</span>

    <span class='comment'># This method creates the accessor methods corresponding to the given group flag.
</span>    <span class='comment'># See, description of StructureableMixins::HasSpecialGroup.
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_has_special_group'>has_special_group</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_child_of'>child_of</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span> <span class='symbol'>:child_of</span> <span class='rbracket'>]</span>
      <span class='id identifier rubyid_global'>global</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span> <span class='symbol'>:global</span> <span class='rbracket'>]</span>

      <span class='comment'># if the special_group is global, the accessors have to be 
</span>      <span class='comment'># class methods, not instance methods.
</span>      <span class='id identifier rubyid_self_or_not'>self_or_not</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>self.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_global'>global</span> 

      <span class='comment'># TODO: Maybe use a block instead: 
</span>      <span class='comment'># http://stackoverflow.com/questions/1011142/include-a-module-to-define-dynamic-class-method
</span>      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='heredoc_beg'>&lt;&lt;-EOL</span>  
<span class='tstring_content'>
      def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>
        find_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
      end

      def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>!
        find_or_create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
      end

      def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='tstring_content'>find_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
        find_special_group( &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; )
      end

      def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='tstring_content'>create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
        create_special_group( &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;, { child_of: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_child_of'>child_of</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; } )
      end

      def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='tstring_content'>find_or_create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
        g = find_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
        g ||= create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
      end

</span><span class='heredoc_end'>      EOL
</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_child_of'>child_of</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='heredoc_beg'>&lt;&lt;-EOL</span>
<span class='tstring_content'>      
        def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='tstring_content'>find_or_create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group_parent
          find_or_create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_child_of'>child_of</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
        end

</span><span class='heredoc_end'>        EOL
</span>      <span class='kw'>else</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='heredoc_beg'>&lt;&lt;-EOL</span>
<span class='tstring_content'>      
        def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='tstring_content'>find_or_create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group_parent
          self
        end

</span><span class='heredoc_end'>        EOL
</span>      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_end_with?'>end_with?</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_parent</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span> <span class='comment'># e.g. &quot;admins_parent&quot;
</span>        <span class='id identifier rubyid_reduced_group_flag'>reduced_group_flag</span> <span class='op'>=</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>_parent$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span> <span class='comment'># e.g. &quot;admins&quot;
</span>
        <span class='comment'># Warning! If the method already exists (even it is defined after `has_special_group` outside,
</span>        <span class='comment'># it is going to be overridden here. Therefore, we only replace it if it does not exist.
</span>        <span class='comment'># http://stackoverflow.com/questions/5944278/overriding-method-by-another-defined-in-module
</span>        <span class='comment'>#
</span>        <span class='kw'>if</span> <span class='kw'>not</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='id identifier rubyid_reduced_group_flag'>reduced_group_flag</span>
          <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='heredoc_beg'>&lt;&lt;-EOL</span>
<span class='tstring_content'>
          def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reduced_group_flag'>reduced_group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>
            return </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>.descendant_users if </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>
          end

          def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reduced_group_flag'>reduced_group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>!
            </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='tstring_content'>find_or_create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group
            return </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_self_or_not'>self_or_not</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reduced_group_flag'>reduced_group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'> 
          end

</span><span class='heredoc_end'>          EOL
</span>        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># This method finds the group of all descendant_groups of this object that matches
</span>  <span class='comment'># the given flag.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_find_special_group'>find_special_group</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span> <span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_descendant_groups'>descendant_groups</span><span class='period'>.</span><span class='id identifier rubyid_find_by_flag'>find_by_flag</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>module</span> <span class='const'>ClassMethods</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_find_special_group'>find_special_group</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span> <span class='rparen'>)</span>
      <span class='const'>Group</span><span class='period'>.</span><span class='id identifier rubyid_find_by_flag'>find_by_flag</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># This method creates a special_group with the given flag as child
</span>  <span class='comment'># of the specified parent group.
</span>  <span class='comment'>#
</span>  <span class='comment'># For example:
</span>  <span class='comment'>#      some_page.create_special_group( :officers_parent )
</span>  <span class='comment'>#      some_page.create_special_group( :admins_parent, :child_of =&gt; :officers_parent )
</span>  <span class='comment'>#      Page.create_special_group( :global_admins_parent ) # global special_group
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_create_special_group'>create_special_group</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_special_group'>find_special_group</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>special group with flag &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; already exists.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_child_of'>child_of</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>find_or_create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group_parent</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>

    <span class='id identifier rubyid_new_special_group'>new_special_group</span> <span class='op'>=</span> <span class='id identifier rubyid_child_of'>child_of</span><span class='period'>.</span><span class='id identifier rubyid_child_groups'>child_groups</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span>
    <span class='id identifier rubyid_new_special_group'>new_special_group</span><span class='period'>.</span><span class='id identifier rubyid_add_flag'>add_flag</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_new_special_group'>new_special_group</span>
  <span class='kw'>end</span>
  <span class='kw'>module</span> <span class='const'>ClassMethods</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_create_special_group'>create_special_group</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rparen'>)</span>
      
      <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_special_group'>find_special_group</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>global special group with flag &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; already exists.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    
      <span class='id identifier rubyid_child_of'>child_of</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>find_or_create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_group_flag'>group_flag</span><span class='embexpr_end'>}</span><span class='tstring_content'>_group_parent</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_child_of'>child_of</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>Class</span>
        <span class='id identifier rubyid_new_special_group'>new_special_group</span> <span class='op'>=</span> <span class='const'>Group</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_new_special_group'>new_special_group</span> <span class='op'>=</span> <span class='id identifier rubyid_child_of'>child_of</span><span class='period'>.</span><span class='id identifier rubyid_child_groups'>child_groups</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_new_special_group'>new_special_group</span><span class='period'>.</span><span class='id identifier rubyid_add_flag'>add_flag</span><span class='lparen'>(</span> <span class='id identifier rubyid_group_flag'>group_flag</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_new_special_group'>new_special_group</span>
      
    <span class='kw'>end</span>
      
  <span class='kw'>end</span>
<span class='kw'>end</span></pre></div></div>

    <div id="footer">
  Generated on Sat Mar 23 00:23:00 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>